<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="screen-orientation" content="portrait"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>直播</title>
  </head>
  <body>
    <div id="app"></div>
    <!--引入webim sdk-->
    <script type="text/javascript" src="static/_static/live/sdk/spark-md5.js"></script>
    <script type="text/javascript" src="static/_static/live/sdk/webim.js?v=1"></script>
    <script type="text/javascript" src="static/_static/live/sdk/json2.js"></script>
    <!--TLS web sdk(只用于托管模式，独立模式不用引入)-->
    <script type="text/javascript" src="https://tls.qcloud.com/libs/api.min.js"></script>
    <script type="text/javascript">
      //tls登录
      function tlsLogin() {
        //跳转到TLS登录页面
        TLSHelper.goLogin({
          sdkappid: loginInfo.sdkAppID,
          acctype: loginInfo.accountType,
          url: window.location.href
        });
      };

      //第三方应用需要实现这个函数，并在这里拿到UserSig
      function tlsGetUserSig(res) {
        //成功拿到凭证
        if (res.ErrorCode == webim.TLS_ERROR_CODE.OK) {
          //从当前URL中获取参数为identifier的值
          loginInfo.identifier = webim.Tool.getQueryString("identifier");
          //拿到正式身份凭证
          loginInfo.userSig = res.UserSig;
          //从当前URL中获取参数为sdkappid的值
          loginInfo.sdkAppID = loginInfo.appIDAt3rd = Number(webim.Tool.getQueryString("sdkappid"));
          //从cookie获取accountType
          var accountType = webim.Tool.getCookie('accountType');
          if (accountType) {
            loginInfo.accountType = accountType;
            sdkLogin();//sdk登录
          } else {
            location.href = location.href.replace(/\?.*$/gi,"");
          }
        } else {
          //签名过期，需要重新登录
          if (res.ErrorCode == webim.TLS_ERROR_CODE.SIGNATURE_EXPIRATION) {
            tlsLogin();
          } else {
            alert("[" + res.ErrorCode + "]" + res.ErrorInfo);
          }
        }
      };

    </script>
    <!--audiojs-->
    <script type="text/javascript" src="static/_static/live/js/audiojs/audio.min.js"></script>
    <!--recorderjs-->
    <script type="text/javascript" src="static/_static/live/js/recorderjs/recorder.js"></script>
    <!-- built files will be auto injected -->
  </body>
</html>
